/* ========= Core layout & variables ========= */
:root{
  --gap: 10px;
  --cell-radius: 18px;
  --text-dark: #2a3a70;
}

body {
  font-family: system-ui, sans-serif;
  margin: 20px;
  background: radial-gradient(1000px 600px at 20% -10%, #f8fbff, #ebf1ff 35%, #e9ecf8 60%, #e7e9f3);
}

/* ========= Board & Stream layout ========= */
.board-stream {
  --sidebar: 360px;          /* tweak stream width */
  display: grid;
  grid-template-columns: 1fr var(--sidebar);
  gap: 20px;
  align-items: start;
}
@media (max-width: 1100px){
  .board-stream { grid-template-columns: 1fr; }
}
.main-wrap { max-width: 1200px; margin: 0 auto; }

/* ========= Board box: exactly 50vw x 50vh (no scrolling) ========= */
.board-wrap {
  width: 50vw;
  height: 50vh;
  margin: 0 auto;
  padding: 8px;
  border-radius: 20px;
  background: rgba(255,255,255,.3);
  backdrop-filter: blur(4px);
  box-shadow: 0 8px 28px rgba(0,0,0,.06);
  overflow: hidden;            /* no scrollbars */
  display: grid;
  place-items: center;
}

/* Grid auto-sizing based on --n (board size).
   Cells are perfectly square and fit inside 50vw x 50vh. */
.board-wrap .grid{
  width: 100%;
  height: 100%;

  /* compute cell size that fits BOTH width & height */
  --cellW: calc((100% - (var(--n) - 1) * var(--gap)) / var(--n));
  --cellH: calc((100% - (var(--n) - 1) * var(--gap)) / var(--n));
  --cell: min(var(--cellW), var(--cellH));

  display: grid;
  grid-template-columns: repeat(var(--n), var(--cell));
  grid-auto-rows: var(--cell);
  gap: var(--gap);
  padding: 6px;

  text-align: center;
  border-radius: 24px;
  background: rgba(255,255,255,.35);
  backdrop-filter: blur(4px);
  border: 1px solid rgba(60, 90, 190, .12);
  box-shadow: 0 10px 30px rgba(20,30,60,.08);
}

/* ========= Stream panel ========= */
.stream-wrap { width: var(--sidebar); max-width: 100%; }
.stream-card {
  position: sticky; top: 10px;
  max-height: 82vh; overflow: auto;
  background: rgba(255,255,255,.6);
  backdrop-filter: blur(4px);
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
  padding: 8px;
}

/* ========= Glossy cells ========= */
.cell {
  width: 100%;                 /* size comes from grid track */
  height: 100%;
  border-radius: var(--cell-radius);
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;

  /* glossy: soft gradient + inner highlights */
  background: linear-gradient(145deg, #f6f8ff, #dfe6ff);
  border: 1px solid rgba(60,90,190,.15);
  box-shadow:
    0 12px 24px rgba(0,20,80,.18),
    inset 0 1px 0 rgba(255,255,255,.75),
    inset 0 -2px 8px rgba(20,40,120,.10);
  transition: transform .14s ease, box-shadow .22s ease, filter .22s ease;
  overflow: hidden;
}

/* specular shine band */
.cell::before {
  content: "";
  position: absolute; inset: -30% -30% auto -30%;
  height: 60%;
  transform: rotate(-12deg);
  background: linear-gradient(to bottom, rgba(255,255,255,.65), rgba(255,255,255,0));
  pointer-events: none;
  filter: blur(1px);
}

/* hover lift + shimmer */
.cell:hover { transform: translateY(-2px) scale(1.03); z-index: 3; }
.cell:hover::after {
  content:""; position:absolute; inset:0;
  background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.18) 40%, transparent 80%);
  animation: sweep 1s;
}
@keyframes sweep { from{ transform: translateX(-100%);} to{ transform: translateX(100%);} }

/* ========= Cell internals ========= */
.cell-value {
  position: absolute;
  top: 6px; left: 8px;
  font-size: 13px; font-weight: 700;
  color: var(--text-dark);
  text-shadow: 0 1px 0 rgba(255,255,255,.8);
  pointer-events: none; opacity: .9;
}

/* “tokens” (name pills) */
.token {
  position: absolute;
  padding: 3px 7px; border-radius: 10px;
  font-size: 11px; line-height: 1;
  pointer-events: none; z-index: 10;
  animation: glow 1.2s ease-in-out infinite alternate;
  color: #0b122b; background: rgba(255,255,255,.85);
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 2px 6px rgba(0,0,0,.2), inset 0 1px 0 rgba(255,255,255,.9);
}

/* token positions */
.pos-center { top: 50%; left: 50%; transform: translate(-50%, -50%); }
.pos-tl { top: 6px; left: 6px; }
.pos-tr { top: 6px; right: 6px; }
.pos-bl { bottom: 6px; left: 6px; }
.pos-br { bottom: 6px; right: 6px; }

/* token glow */
@keyframes glow {
  from {
    box-shadow: 0 0 6px rgba(255, 255, 255, .25), 0 0 0 0 rgba(80,160,255,0.0);
    transform: scale(1);
  }
  to {
    box-shadow: 0 0 12px rgba(255, 255, 255, .7), 0 0 18px 6px rgba(80,160,255,.45);
    transform: scale(1.04);
  }
}

/* ========= Interactions from events ========= */
.cell.pop { animation: pop .18s ease; }
@keyframes pop { 50% { transform: scale(1.06); } }

/* portal cells (use .portal + style="--portal:#color") */
.cell.portal {
  background:
    radial-gradient(120% 120% at 110% -10%, rgba(255,255,255,.72), transparent 35%),
    conic-gradient(from 0deg, var(--portal, #7f5af0), #00d4ff, #7f5af0);
  border-color: rgba(127,90,240,.35);
  animation: portalSpin 6s linear infinite;
  color: #0b122b;
}
@keyframes portalSpin { to { filter: hue-rotate(360deg); } }

/* portal ripple pulse */
.cell.ripple::after {
  content:""; position:absolute; inset:0; border-radius: inherit;
  border: 2px solid rgba(255,255,255,.95);
  animation: ripple .6s ease-out;
}
@keyframes ripple {
  from { transform: scale(.82); opacity: .95; }
  to   { transform: scale(1.12); opacity: 0; }
}

/* ========= Dice ========= */
.dice {
  width: 44px; height: 44px; border-radius: 12px; background: #fff;
  display: grid; place-items: center; font-weight: 800;
  box-shadow: 0 10px 24px rgba(0,0,0,.18); user-select: none;
}
.dice.roll { animation: shake .6s ease; }
@keyframes shake{
  10%, 90% { transform: translate(-1px, 0) rotate(-2deg); }
  20%, 80% { transform: translate( 2px, 0) rotate( 2deg); }
  30%, 50%, 70% { transform: translate(-4px, 0) rotate(-3deg); }
  40%, 60% { transform: translate( 4px, 0) rotate( 3deg); }
}

/* ========= Board glow & progress pill ========= */
.grid.glow { box-shadow: 0 0 0 0 rgba(127,90,240,.35); animation: gridglow .7s ease; }
@keyframes gridglow {
  from { box-shadow: 0 0 0 14px rgba(127,90,240,0.0); }
  to   { box-shadow: 0 0 0 0 rgba(127,90,240,0.0); }
}

.progress-pill { height: 10px; border-radius: 999px; background: rgba(20,30,60,.12); overflow: hidden; }
.progress-pill > span {
  display:block; height:100%;
  background: linear-gradient(90deg, #00d4ff, #7f5af0);
  box-shadow: 0 0 12px rgba(127,90,240,.45);
  width: 0%; transition: width .25s ease;
}

/* ========= Responsive tweaks ========= */
@media (max-width: 600px){
  .board-stream { grid-template-columns: 1fr; }
}
